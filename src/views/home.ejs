<%- include("partials/head", { title }) %>
<%- include("partials/nav") %>

<% const pageError = typeof error !== "undefined" ? error : null; %>
<% const list = (typeof trending !== "undefined" && Array.isArray(trending)) ? trending : []; %>

<main class="hero">
  <div class="hero-card">
    <h1>Movie Search Database</h1>
    <p>Search TMDB and view movie details.</p>
    <% if (!user) { %>
      <div class="banner">Login required to search and view movie details.</div>
    <% } %>
    <form class="search" method="GET" action="/movies/search">
      <input type="text" name="query" placeholder="Search for a movie..." />
      <button type="submit">Search</button>
    </form>
  </div>

  <section class="trending">
    <h2>Trending This Week</h2>
    <% if (pageError) { %>
      <p class="error"><%= pageError %></p>
    <% } %>
    <div class="grid">
      <% list.forEach((movie) => { %>
        <a class="movie" href="/movies/<%= movie.id %>">
          <div class="poster">
            <% if (movie.poster_path) { %>
              <img src="https://image.tmdb.org/t/p/w300<%= movie.poster_path %>" alt="<%= movie.title %>" />
            <% } else { %>
              <div class="placeholder">No Image</div>
            <% } %>
          </div>
          <h3><%= movie.title %></h3>
          <p><%= movie.release_date || "" %></p>
        </a>
      <% }) %>
    </div>
  </section>
</main>

<%- include("partials/footer") %>
